# 金流設定與訂單付款狀態管理 施工計畫

## 一、需求分析與規劃

1. 明確三種金流方式的設定需求與欄位
   - 轉帳：收款銀行、帳號、戶名
   - Line Pay：Channel ID、Channel Secret、商店名稱等
   - 綠界：Merchant ID、HashKey、HashIV、API URL 等
2. 訂單付款狀態的定義（如：未付款、已付款、付款失敗、退款等）
3. 管理員操作流程與權限確認

---

## 二、資料庫設計

1. 新增 `payment_settings` 表（或於 `settings` 表擴充）
   - 欄位：id, method (enum: transfer, linepay, ecpay), enabled, config(json), created_at, updated_at
2. 調整 `order` 表
   - 新增/調整欄位：payment_method, payment_status, payment_info(json), payment_updated_at

---

## 三、後台管理介面

1. 金流設定頁面
   - 顯示三種金流方式，管理員可切換啟用/停用
   - 各金流方式可填寫/編輯所需設定資料
   - 儲存、驗證、提示功能
2. 訂單管理頁面
   - 顯示訂單付款狀態
   - 管理員可手動修改付款狀態（下拉選單/按鈕）
   - 顯示金流回傳資訊（如有）

---

## 四、API 與後端邏輯

1. 金流設定 API
   - 取得/更新金流設定
2. 訂單付款狀態 API
   - 取得/更新訂單付款狀態
   - 金流自動回傳（callback/webhook）API
3. 權限驗證（僅管理員可操作）

---

## 五、金流整合

1. 轉帳：僅顯示收款資訊，無需串接
2. Line Pay
   - 設定資料填寫
   - 建立付款請求、處理回傳
   - 測試沙盒環境
3. 綠界
   - 設定資料填寫
   - 建立訂單、處理付款回傳（自動更新訂單狀態）
   - 測試沙盒環境

---

## 六、訂單付款狀態管理

1. 手動設定
   - 後台介面可直接修改付款狀態
   - 變更時記錄操作人與時間
2. 自動更新
   - 金流回傳時自動更新訂單狀態
   - 記錄金流回傳資訊

---

## 七、測試與驗證

1. 單元測試
   - 金流設定 API
   - 訂單付款狀態 API
2. 介面測試
   - 後台金流設定與訂單管理頁面
3. 金流串接測試
   - Line Pay、綠界沙盒測試
4. 權限測試
   - 僅管理員可操作

---

## 八、文件與交付

1. 使用說明文件
   - 金流設定操作說明
   - 訂單付款狀態管理說明
2. API 文件
   - 金流設定/訂單狀態 API 規格
3. 測試報告

---

## 九、時程建議（可依實際人力調整）

| 階段                | 預估工時 |
|---------------------|----------|
| 需求分析/規劃       | 1 天     |
| 資料庫設計          | 0.5 天   |
| 後台介面            | 2 天     |
| API 與後端邏輯      | 2 天     |
| 金流整合            | 2 天     |
| 狀態管理            | 1 天     |
| 測試與驗證          | 1 天     |
| 文件與交付          | 0.5 天   |
| **總計**            | **10 天**|

---

> 本計畫將嚴格依照上述步驟分階段執行，並於每階段完成時主動回報與徵詢回饋。 