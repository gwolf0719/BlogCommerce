{% extends "base.html" %}

{% block title %}ä¼´ç¸å®¶ - æ‰“é€ å¹¸ç¦æ—¥å¸¸{% endblock %}

{% block description %}{{ settings.site_description }}{% endblock %}

{% block keywords %}{{ settings.default_meta_keywords or 'é›»å•†,éƒ¨è½æ ¼,è³¼ç‰©,æ–‡ç« ,å•†å“' }}{% endblock %}

{% block og_title %}{{ settings.site_name }}{% endblock %}

{% block og_description %}{{ settings.site_description }}{% endblock %}

{% block og_type %}website{% endblock %}

{% block og_image %}{{ settings.site_logo }}{% endblock %}

{% block twitter_title %}{{ settings.site_name }}{% endblock %}

{% block twitter_description %}{{ settings.site_description }}{% endblock %}

{% block twitter_image %}{{ settings.site_logo }}{% endblock %}

{% block content %}
<div x-data="homeApp()" x-init="loadContent()">
    <!-- é¦–é å»£å‘Šè¼ªæ’­ - æ»¿ç‰ˆè¨­è¨ˆ -->
    <section class="bg-white">
        <div class="w-full">
            <div x-data="bannerCarousel()" x-init="loadBanners('HOME')" class="mb-0">
                <div x-show="banners.length > 0" class="relative">
                    <!-- è¼ªæ’­å®¹å™¨ -->
                    <div class="relative overflow-hidden">
                        <template x-for="(banner, index) in banners" :key="banner.id">
                            <div x-show="currentIndex === index" 
                                 x-transition:enter="transition ease-out duration-300"
                                 x-transition:enter-start="opacity-0 transform translate-x-full"
                                 x-transition:enter-end="opacity-100 transform translate-x-0"
                                 x-transition:leave="transition ease-in duration-300"
                                 x-transition:leave-start="opacity-100 transform translate-x-0"
                                 x-transition:leave-end="opacity-0 transform -translate-x-full"
                                 class="relative">
                                <a :href="banner.link_url" @click="trackClick(banner.id)" class="block">
                                    <!-- æ¡Œé¢ç‰ˆåœ–ç‰‡ -->
                                    <img :src="banner.desktop_image" 
                                         :alt="banner.alt_text || banner.title"
                                         class="hidden md:block w-full h-96 lg:h-[500px] object-cover">
                                    <!-- æ‰‹æ©Ÿç‰ˆåœ–ç‰‡ -->
                                    <img :src="banner.mobile_image" 
                                         :alt="banner.alt_text || banner.title"
                                         class="md:hidden w-full h-64 object-cover">
                                    <!-- ç§»é™¤æ¨™é¡Œè¦†è“‹å±¤ -->
                                </a>
                            </div>
                        </template>
                    </div>
                    
                    <!-- å°èˆªæŒ‰éˆ• -->
                    <template x-if="banners.length > 1">
                        <div>
                            <!-- ä¸Šä¸€å¼µ -->
                            <button @click="prevSlide()" 
                                    class="absolute left-4 top-1/2 transform -translate-y-1/2 bg-white/80 hover:bg-white text-gray-800 rounded-full p-2 shadow-lg transition-all duration-200">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                                </svg>
                            </button>
                            <!-- ä¸‹ä¸€å¼µ -->
                            <button @click="nextSlide()" 
                                    class="absolute right-4 top-1/2 transform -translate-y-1/2 bg-white/80 hover:bg-white text-gray-800 rounded-full p-2 shadow-lg transition-all duration-200">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                                </svg>
                            </button>
                            
                            <!-- æŒ‡ç¤ºå™¨ -->
                            <div class="absolute bottom-4 left-1/2 transform -translate-x-1/2 flex space-x-2">
                                <template x-for="(banner, index) in banners" :key="index">
                                    <button @click="currentIndex = index" 
                                            :class="currentIndex === index ? 'bg-white' : 'bg-white/50'"
                                            class="w-3 h-3 rounded-full transition-all duration-200"></button>
                                </template>
                            </div>
                        </div>
                    </template>
                </div>
            </div>
        </div>
    </section>
    
    <!-- Hero Section -->
    <section x-show="false" class="relative bg-gradient-to-br from-primary-600 via-primary-700 to-primary-800 overflow-hidden">
        <!-- èƒŒæ™¯è£é£¾ -->
        <div class="absolute inset-0">
            <div class="absolute top-0 -left-4 w-72 h-72 bg-primary-500 rounded-full mix-blend-multiply filter blur-xl opacity-70 animate-blob"></div>
            <div class="absolute top-0 -right-4 w-72 h-72 bg-purple-500 rounded-full mix-blend-multiply filter blur-xl opacity-70 animate-blob animation-delay-2000"></div>
            <div class="absolute -bottom-8 left-20 w-72 h-72 bg-pink-500 rounded-full mix-blend-multiply filter blur-xl opacity-70 animate-blob animation-delay-4000"></div>
        </div>
        
        <div class="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16 lg:py-24">
            <div class="text-center">
                <!-- ä¸»æ¨™é¡Œ -->
                <h1 class="text-4xl sm:text-5xl lg:text-6xl font-bold text-white mb-6">
                    <span class="block">æ­¡è¿ä¾†åˆ°</span>
                    <span class="block bg-gradient-to-r from-yellow-400 to-orange-400 bg-clip-text text-transparent">
                        {{ settings.site_name }}
                    </span>
                </h1>
                
                <!-- æè¿°æ–‡å­— -->
                <p class="text-xl sm:text-2xl text-primary-100 mb-10 max-w-3xl mx-auto leading-relaxed">
                    {{ settings.site_description }}
                </p>
                
                <!-- è¡Œå‹•æŒ‰éˆ• -->
                <div class="flex flex-col sm:flex-row gap-4 justify-center">
                    <a href="/products" class="inline-flex items-center justify-center px-8 py-4 bg-white text-primary-700 rounded-2xl font-semibold hover:bg-gray-50 transition-all duration-300 transform hover:scale-105 shadow-lg">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2v-9a2 2 0 012-2z"></path>
                        </svg>
                        æ¢ç´¢å•†å“
                    </a>
                    <a href="/blog" class="inline-flex items-center justify-center px-8 py-4 bg-transparent text-white border-2 border-white rounded-2xl font-semibold hover:bg-white hover:text-primary-700 transition-all duration-300 transform hover:scale-105">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z"></path>
                        </svg>
                        é–±è®€éƒ¨è½æ ¼
                    </a>
                </div>
            </div>
        </div>
        
        <!-- å‘ä¸‹ç®­é ­ -->
        <div class="absolute bottom-8 left-1/2 transform -translate-x-1/2 animate-bounce">
            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3"></path>
            </svg>
        </div>
    </section>
  <!-- Features Section -->
  <section class="bg-white py-32">
    <div class="mx-auto max-w-7xl px-8">
      <div class="grid grid-cols-1 gap-20 md:grid-cols-3">
        <!-- Feature 1 -->
        <div class="flex flex-col items-center text-center">
          <div class="mb-3 h-16 w-16">
            <img src="../static/assets/home-feature1.svg" alt="å…±äº«å¹¸ç¦æ™‚å…‰" />
          </div>
          <h3 class="mb-4 text-xl font-bold text-[#121212]">å…±äº«å¹¸ç¦æ™‚å…‰</h3>
          <p class="text-base leading-relaxed text-[#121212]">æˆ‘å€‘è¨­è¨ˆçš„ä¸åªæ˜¯ç”¢å“ï¼Œè€Œæ˜¯ä½ å’Œæ¯›å­©çš„ç”Ÿæ´»é¢¨æ™¯ã€‚</p>
        </div>

        <!-- Feature 2 -->
        <div class="flex flex-col items-center text-center">
          <div class="mb-3 h-16 w-16">
            <img src="../static/assets/home-feature2.svg" alt="" />
          </div>
          <h3 class="mb-4 text-xl font-bold text-[#121212]">è²¼è¿‘ç”Ÿæ´»çš„å‹å–„é¸æ“‡</h3>
          <p class="text-base leading-relaxed text-[#121212]">æ¸›å°‘éåº¦åŒ…è£ã€ä½¿ç”¨è¼•æŸ”ä¸å‚·ç’°å¢ƒçš„æè³ªï¼Œè®“æ„›å¾æ—¥å¸¸é–‹å§‹ã€‚</p>
        </div>

        <!-- Feature 3 -->
        <div class="flex flex-col items-center text-center">
          <div class="mb-3 h-16 w-16">
            <img src="../static/assets/home-feature3.svg" alt="ç”¨å¿ƒè£½ä½œæ¯ä¸€ä»¶å°äº‹" />
          </div>
          <h3 class="mb-4 text-xl font-bold text-[#121212]">ç”¨å¿ƒè£½ä½œæ¯ä¸€ä»¶å°äº‹</h3>
          <p class="text-base leading-relaxed text-[#121212]">å¾å‡ºè²¨åˆ°åŒ…è£ï¼Œå‚³éæˆ‘å€‘å°æ¯›å­©çš„æ„›èˆ‡ç´°ç¯€çš„å …æŒã€‚</p>
        </div>
      </div>
    </div>
  </section>

    <!-- Featured Products -->
    <section class="py-16 lg:py-24 bg-gray-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-12">
                <h2 class="text-3xl lg:text-4xl font-bold text-gray-900 mb-4">å…¨ç«™å•†å“</h2>
                <!-- <p class="text-xl text-gray-600 max-w-2xl mx-auto mb-8">ç™¼ç¾æˆ‘å€‘ç²¾å¿ƒæŒ‘é¸çš„ç†±é–€å•†å“</p> -->
                <!-- <div class="w-24 h-1 bg-gradient-to-r from-primary-500 to-primary-600 mx-auto rounded-full"></div> -->
            </div>
            
            <!-- Loading State -->
            <div x-show="productsLoading" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                <template x-for="i in 4">
                    <div class="bg-white rounded-2xl shadow-sm border border-gray-200 overflow-hidden animate-pulse">
                        <div class="aspect-square bg-gray-200"></div>
                        <div class="p-6">
                            <div class="h-4 bg-gray-200 rounded mb-2"></div>
                            <div class="h-4 bg-gray-200 rounded w-2/3 mb-4"></div>
                            <div class="h-6 bg-gray-200 rounded w-1/2"></div>
                        </div>
                    </div>
                </template>
            </div>
            
            <!-- Products Grid -->
            <div x-show="!productsLoading" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                <template x-for="product in featuredProducts" :key="product.id">
                    <div class="bg-white rounded-2xl shadow-sm border border-gray-200 hover:shadow-xl transition-all duration-300 transform hover:-translate-y-2 group overflow-hidden flex flex-col h-full">
                        <!-- å•†å“åœ–ç‰‡ -->
                        <div class="aspect-square overflow-hidden bg-gray-100 relative">
                            <img :src="product.featured_image || '/static/images/default-product.jpg'" 
                                 :alt="product.name"
                                 class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500">
                            
                            <!-- æŠ˜æ‰£æ¨™ç±¤ -->
                            <div x-show="product.sale_price && product.sale_price < product.price" 
                                 class="absolute top-4 left-4 bg-red-500 text-white px-3 py-1 rounded-full text-sm font-medium">
                                æŠ˜æ‰£
                            </div>
                            
                            <!-- å¿«é€ŸåŠ å…¥è³¼ç‰©è»Š -->
                            <button @click="addToCart(product.id, 1)" 
                                    class="absolute bottom-4 right-4 w-12 h-12 bg-primary-600 text-white rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-all duration-300 hover:bg-primary-700 transform hover:scale-110">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4m0 0L7 13m0 0l-1.5 9M7 13h10"></path>
                                </svg>
                            </button>
                        </div>
                        
                        <!-- å•†å“è³‡è¨Š -->
                        <div class="p-6 flex flex-col flex-grow">
                            <h3 class="font-semibold text-gray-900 mb-2 line-clamp-2 group-hover:text-primary-600 transition-colors duration-200 h-12 flex items-center" x-text="product.name"></h3>
                            <p class="text-gray-600 text-sm mb-4 line-clamp-3 flex-grow h-16 overflow-hidden" x-text="product.short_description"></p>
                            
                            <!-- åƒ¹æ ¼ -->
                            <div class="flex items-center space-x-2 mb-4">
                                <span x-show="product.sale_price && product.sale_price < product.price" 
                                      class="text-xl font-bold text-red-600" 
                                      x-text="'NT$ ' + (product.sale_price || 0).toLocaleString()"></span>
                                <span :class="product.sale_price && product.sale_price < product.price ? 'text-sm text-gray-500 line-through' : 'text-xl font-bold text-gray-900'" 
                                      x-text="'NT$ ' + (product.price || 0).toLocaleString()"></span>
                            </div>
                            
                            <!-- æŸ¥çœ‹è©³æƒ…æŒ‰éˆ• -->
                            <a :href="'/product/' + product.slug" 
                               class="block w-full bg-gray-900 text-white text-center py-3 rounded-xl font-medium hover:bg-primary-600 transition-colors duration-200">
                                æŸ¥çœ‹è©³æƒ…
                            </a>
                        </div>
                    </div>
                </template>
            </div>
            
            <!-- æŸ¥çœ‹æ›´å¤šæŒ‰éˆ• -->
            <div class="text-center mt-12">
                <a href="/products" class="inline-flex items-center px-8 py-4 bg-primary-600 text-white rounded-2xl font-semibold hover:bg-primary-700 transition-all duration-300 transform hover:scale-105">
                    æŸ¥çœ‹æ‰€æœ‰å•†å“
                    <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path>
                    </svg>
                </a>
            </div>
        </div>
    </section>

    <!-- Latest Blog Posts -->
    <section class="py-16 lg:py-24 bg-white">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-12">
                <h2 class="text-3xl lg:text-4xl font-bold text-gray-900 mb-4">æœ€æ–°æ–‡ç« </h2>
                <p class="text-xl text-gray-600 max-w-2xl mx-auto mb-8">é–±è®€æˆ‘å€‘çš„æœ€æ–°å…§å®¹èˆ‡å°ˆæ¥­è¦‹è§£</p>
                <div class="w-24 h-1 bg-gradient-to-r from-primary-500 to-primary-600 mx-auto rounded-full"></div>
            </div>
            
            <!-- Loading State -->
            <div x-show="postsLoading" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                <template x-for="i in 3">
                    <div class="bg-white rounded-2xl shadow-sm border border-gray-200 overflow-hidden animate-pulse">
                        <div class="aspect-video bg-gray-200"></div>
                        <div class="p-6">
                            <div class="h-4 bg-gray-200 rounded mb-2"></div>
                            <div class="h-4 bg-gray-200 rounded w-2/3 mb-4"></div>
                            <div class="h-20 bg-gray-200 rounded"></div>
                        </div>
                    </div>
                </template>
            </div>
            
            <!-- Posts Grid -->
            <div x-show="!postsLoading" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                <template x-for="post in latestPosts" :key="post.id">
                    <article class="bg-white rounded-2xl shadow-sm border border-gray-200 hover:shadow-xl transition-all duration-300 transform hover:-translate-y-2 group overflow-hidden flex flex-col h-full">
                        <!-- æ–‡ç« åœ–ç‰‡ -->
                        <div class="aspect-video bg-gray-100 relative overflow-hidden" x-show="post.featured_image">
                            <img :src="post.featured_image || '/static/images/default-blog.jpg'" 
                                 :alt="post.title"
                                 class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110">
                                 
                            <!-- åˆ†é¡æ¨™ç±¤å·²ç§»é™¤ -->
                        </div>
                        
                        <!-- æ²’æœ‰åœ–ç‰‡æ™‚çš„ä½”ä½ -->
                        <div class="aspect-video bg-gradient-to-br from-gray-100 to-gray-200 relative overflow-hidden flex items-center justify-center" x-show="!post.featured_image">
                            <div class="text-6xl text-gray-400">ğŸ“</div>
                            
                            <!-- åˆ†é¡æ¨™ç±¤å·²ç§»é™¤ -->
                        </div>
                        
                        <!-- æ–‡ç« å…§å®¹ -->
                        <div class="p-6">
                            <h3 class="text-xl font-semibold text-gray-900 mb-3 line-clamp-2 group-hover:text-primary-600 transition-colors duration-200">
                                <a :href="'/blog/' + post.slug" 
                                   class="hover:text-primary-600 transition-colors"
                                   x-text="post.title">
                                </a>
                            </h3>
                            <p class="text-gray-600 mb-4 line-clamp-3" x-text="post.excerpt"></p>
                            
                            <!-- ç™¼ä½ˆæ™‚é–“ -->
                            <div class="flex items-center justify-between text-sm text-gray-500 mb-4">
                                <div class="flex items-center space-x-2">
                                    <div class="w-8 h-8 bg-gradient-to-br from-primary-500 to-primary-600 rounded-full flex items-center justify-center">
                                        <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                                        </svg>
                                    </div>
                                    <span>ç®¡ç†å“¡</span>
                                </div>
                                <time x-text="new Date(post.created_at).toLocaleDateString('zh-TW')"></time>
                            </div>
                            
                            <!-- é–±è®€æ›´å¤šæŒ‰éˆ• -->
                            <a :href="'/blog/' + post.slug" 
                               class="inline-flex items-center text-primary-600 hover:text-primary-700 font-medium transition-colors duration-200">
                                é–±è®€æ›´å¤š
                                <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path>
                                </svg>
                            </a>
                        </div>
                    </article>
                </template>
            </div>
            
            <!-- æŸ¥çœ‹æ›´å¤šæŒ‰éˆ• -->
            <div class="text-center mt-12">
                <a href="/blog" class="inline-flex items-center px-8 py-4 bg-primary-600 text-white rounded-2xl font-semibold hover:bg-primary-700 transition-all duration-300 transform hover:scale-105">
                    æŸ¥çœ‹æ‰€æœ‰æ–‡ç« 
                    <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path>
                    </svg>
                </a>
            </div>
        </div>
    </section>

    <!-- Newsletter Section -->
    <section  x-show="false" class="py-16 lg:py-24 bg-gradient-to-br from-primary-600 to-primary-800">
        <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <h2 class="text-3xl lg:text-4xl font-bold text-white mb-4">è¨‚é–±æˆ‘å€‘çš„æœ€æ–°æ¶ˆæ¯</h2>
            <p class="text-xl text-primary-100 mb-10 max-w-2xl mx-auto">ç²å¾—ç¬¬ä¸€æ‰‹çš„ç”¢å“è³‡è¨Šèˆ‡å„ªæƒ æ´»å‹•é€šçŸ¥</p>
            
            <form class="flex flex-col sm:flex-row gap-4 max-w-md mx-auto" @submit.prevent="subscribe()">
                <input type="email" 
                       placeholder="è¼¸å…¥æ‚¨çš„é›»å­éƒµä»¶" 
                       class="flex-1 px-6 py-4 rounded-2xl border-0 focus:ring-2 focus:ring-primary-300 focus:outline-none text-gray-900 placeholder-gray-500"
                       x-model="email"
                       required>
                <button type="submit" 
                        class="px-8 py-4 bg-white text-primary-700 rounded-2xl font-semibold hover:bg-gray-50 transition-all duration-300 transform hover:scale-105 whitespace-nowrap">
                    è¨‚é–±
                </button>
            </form>
            
            <p class="text-primary-100 text-sm mt-6">æˆ‘å€‘æ‰¿è«¾ä¿è­·æ‚¨çš„éš±ç§ï¼Œæ‚¨å¯ä»¥éš¨æ™‚å–æ¶ˆè¨‚é–±</p>
        </div>
    </section>
</div>

<script>
function homeApp() {
    return {
        featuredProducts: [],
        latestPosts: [],
        productsLoading: true,
        postsLoading: true,
        email: '',
        
        async loadContent() {
            await Promise.all([
                this.loadFeaturedProducts(),
                this.loadLatestPosts()
            ]);
        },
        
        async loadFeaturedProducts() {
            try {
                const response = await fetch('/api/products?limit=4&active=true');
                if (response.ok) {
                    const data = await response.json();
                    this.featuredProducts = data.items || data;
                    console.log('è¼‰å…¥å•†å“æˆåŠŸ:', this.featuredProducts.length, 'å€‹å•†å“');
                }
            } catch (error) {
                console.error('è¼‰å…¥ç²¾é¸å•†å“å¤±æ•—:', error);
            } finally {
                this.productsLoading = false;
            }
        },
        
        async loadLatestPosts() {
            console.log('è¼‰å…¥æœ€æ–°æ–‡ç« ');
            try {
                const response = await fetch('/api/posts?limit=3');
                if (response.ok) {
                    const data = await response.json();
                    this.latestPosts = data.items || data;
                    console.log('è¼‰å…¥æ–‡ç« æˆåŠŸ:', this.latestPosts.length, 'ç¯‡æ–‡ç« ');
                } else {
                    console.error('æ–‡ç«  API éŒ¯èª¤:', response.status, await response.text());
                }
            } catch (error) {
                console.error('è¼‰å…¥æœ€æ–°æ–‡ç« å¤±æ•—:', error);
            } finally {
                this.postsLoading = false;
            }
        },
        
        async addToCart(productId, quantity = 1) {
            try {
                const response = await fetch('/api/cart/add', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        product_id: productId,
                        quantity: quantity
                    })
                });
                
                if (response.ok) {
                    // æ›´æ–°è³¼ç‰©è»Šè¨ˆæ•¸
                    window.updateCartCount();
                    
                    // é¡¯ç¤ºæˆåŠŸè¨Šæ¯
                    this.showNotification('å•†å“å·²åŠ å…¥è³¼ç‰©è»Šï¼', 'success');
                } else {
                    throw new Error('åŠ å…¥è³¼ç‰©è»Šå¤±æ•—');
                }
            } catch (error) {
                console.error('åŠ å…¥è³¼ç‰©è»ŠéŒ¯èª¤:', error);
                this.showNotification('åŠ å…¥è³¼ç‰©è»Šå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦', 'error');
            }
        },
        
        formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('zh-TW', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        },
        
        showNotification(message, type = 'info') {
            // å‰µå»ºé€šçŸ¥å…ƒç´ 
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 z-50 px-6 py-4 rounded-xl shadow-lg transition-all duration-300 transform translate-x-full ${
                type === 'success' ? 'bg-green-500 text-white' : 
                type === 'error' ? 'bg-red-500 text-white' : 
                'bg-primary-600 text-white'
            }`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            // é¡¯ç¤ºå‹•ç•«
            setTimeout(() => {
                notification.classList.remove('translate-x-full');
            }, 100);
            
            // è‡ªå‹•éš±è—
            setTimeout(() => {
                notification.classList.add('translate-x-full');
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        },
        
        async subscribe() {
            try {
                const response = await fetch('/api/newsletter/subscribe', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email: this.email })
                });
                if (!response.ok) {
                    const data = await response.json();
                    throw new Error(data.detail || 'è¨‚é–±å¤±æ•—');
                }
                this.email = '';
                this.showNotification('æ„Ÿè¬æ‚¨çš„è¨‚é–±ï¼', 'success');
            } catch (error) {
                console.error('è¨‚é–±éŒ¯èª¤:', error);
                this.showNotification(error.message || 'è¨‚é–±å¤±æ•—', 'error');
            }
        }
    }
}

function bannerCarousel() {
    return {
        banners: [],
        currentIndex: 0,
        autoPlayInterval: null,
        
        async loadBanners(position) {
            try {
                const response = await fetch(`/api/banners/active/${position}`);
                if (response.ok) {
                    this.banners = await response.json();
                    console.log('è¼‰å…¥å»£å‘ŠæˆåŠŸ:', this.banners.length, 'å€‹å»£å‘Š');
                    if (this.banners.length > 1) {
                        this.startAutoPlay();
                    }
                } else {
                    console.error('å»£å‘Š API éŒ¯èª¤:', response.status, await response.text());
                }
            } catch (error) {
                console.error('è¼‰å…¥å»£å‘Šå¤±æ•—:', error);
            }
        },
        
        nextSlide() {
            this.currentIndex = (this.currentIndex + 1) % this.banners.length;
        },
        
        prevSlide() {
            this.currentIndex = this.currentIndex === 0 ? this.banners.length - 1 : this.currentIndex - 1;
        },
        
        startAutoPlay() {
            this.autoPlayInterval = setInterval(() => {
                this.nextSlide();
            }, 5000); // 5ç§’è‡ªå‹•åˆ‡æ›
        },
        
        stopAutoPlay() {
            if (this.autoPlayInterval) {
                clearInterval(this.autoPlayInterval);
                this.autoPlayInterval = null;
            }
        },
        
        async trackClick(bannerId) {
            try {
                await fetch(`/api/banners/${bannerId}/click`, { method: 'POST' });
            } catch (error) {
                console.error('è¨˜éŒ„é»æ“Šå¤±æ•—:', error);
            }
        }
    }
}
</script>

<style>
.line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

.line-clamp-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
}
</style>
{% endblock %} 